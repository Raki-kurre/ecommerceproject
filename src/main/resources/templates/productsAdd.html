<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>üçΩÔ∏è Add Product</title>

<link rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
<link rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
</head>

<body>

<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container mt-5">

    <a th:href="@{/admin/products}" class="btn btn-secondary mb-3">
        ‚Üê Back to Products
    </a>

    <h3>Add New Product</h3>

    <form th:action="@{/admin/products/add}"
          method="post"
          th:object="${productDTO}"
          enctype="multipart/form-data">

        <!-- CSRF -->
        <input type="hidden"
               th:name="${_csrf.parameterName}"
               th:value="${_csrf.token}">

        <input type="hidden" th:field="*{id}">

        <div class="form-group">
            <label>Name</label>
            <input class="form-control" th:field="*{name}" required>
        </div>

        <div class="form-group">
            <label>Category</label>
            <select class="form-control"
                    th:field="*{categoryId}"
                    th:if="${categories != null and !#lists.isEmpty(categories)}">
                <option th:each="c : ${categories}"
                        th:value="${c.id}"
                        th:text="${c.name}">
                </option>
            </select>

            <p th:if="${#lists.isEmpty(categories)}" class="text-warning">
                Please add category first
            </p>
        </div>

        <div class="form-group">
            <label>Price</label>
            <input type="number" class="form-control" th:field="*{price}" required>
        </div>

        <div class="form-group">
            <label>Weight</label>
            <input type="number" class="form-control" th:field="*{weight}" required>
        </div>

        <div class="form-group">
            <label>Description</label>
            <textarea class="form-control" th:field="*{description}"></textarea>
        </div>

        <div class="form-group">
            <label>Product Image</label>
            <input type="file"
                   name="productImage"
                   class="form-control"
                   accept="image/png, image/jpeg">

            <img th:if="${productDTO.imageName != null}"
                 th:src="@{/productImages/{img}(img=${productDTO.imageName})}"
                 width="100" class="mt-2">

            <input type="hidden" name="imgName"
                   th:value="${productDTO.imageName}">
        </div>

        <button class="btn btn-success">Save Product</button>
    </form>
    <a th:href="@{/}" class="btn btn-secondary mt-3">‚Üê Back to Home</a>
</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
<script>
$('#productImage').change(function () {
    const file = this.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = e => $('#imgPreview').attr('src', e.target.result);
        reader.readAsDataURL(file);
    }
});
</script>


</body>
</html>