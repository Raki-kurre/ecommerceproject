<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<title> üçΩÔ∏è Spark Cloud Kitchen</title>
<link rel="icon" type="image/png" href="/images/spark.png">

<!-- Bootstrap -->
<link rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

<!-- Font Awesome -->
<link rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">

<style>
body {
    background: linear-gradient(to right, #2c5364, #203a43, #0f2027);
    animation: fadeIn 0.8s ease-in;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
.container {
    max-width: 650px;
    margin-top: 90px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.4);
}
h3, label, p { color: #fff; }
.btn { border-radius: 30px; transition: 0.3s; }
.btn:hover { transform: scale(1.05); }
img { border-radius: 10px; }
.btn-back {
    background: linear-gradient(135deg, #6c757d, #343a40);
    color: white;
    padding: 8px 20px;
    border-radius: 50px;
}
</style>
</head>

<body>

<!-- NAVBAR -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container">

    <div class="mb-3">
        <a th:href="@{/admin/products}" class="btn btn-back">‚Üê Back to Products</a>
    </div>

    <h3><i class="fas fa-plus-circle"></i> Add a New Product</h3>

    <!-- ‚úÖ FORM -->
    <form th:action="@{/admin/products/add}"
          method="post"
          th:object="${productDTO}"
          enctype="multipart/form-data">

        <!-- ‚úÖ CSRF (MANDATORY) -->
        <input type="hidden"
               th:name="${_csrf.parameterName}"
               th:value="${_csrf.token}">

        <input type="hidden" th:field="*{id}">

        <div class="form-group">
            <label>Name</label>
            <input type="text" class="form-control"
                   th:field="*{name}" required>
        </div>

        <div class="form-group">
            <label>Select Category</label>
            <select class="form-control" th:field="*{categoryId}" required>
                <option th:each="category : ${categories}"
                        th:value="${category.id}"
                        th:text="${category.name}">
                </option>
            </select>
        </div>

        <div class="form-group">
            <label>Price</label>
            <input type="number" class="form-control"
                   th:field="*{price}" required>
        </div>

        <div class="form-group">
            <label>Weight (grams)</label>
            <input type="number" class="form-control"
                   th:field="*{weight}" required>
        </div>

        <div class="form-group">
            <label>Description</label>
            <textarea class="form-control"
                      rows="4"
                      th:field="*{description}"></textarea>
        </div>

        <!-- ‚úÖ IMAGE -->
        <div class="form-group">
            <p>Product Image</p>

            <input type="file"
                   class="form-control"
                   id="productImage"
                   name="productImage"
                   accept="image/png, image/jpeg">

            <!-- ‚úÖ PREVIEW -->
            <img id="imgPreview"
                 th:if="${productDTO.imageName != null}"
                 th:src="@{/product-images/{img}(img=${productDTO.imageName})}"
                 width="100" height="100"
                 class="mt-3">

            <input type="hidden"
                   name="imgName"
                   th:value="${productDTO.imageName}">
        </div>

        <button type="submit" class="btn btn-success btn-block mt-3">
            <i class="fas fa-check"></i> Save Product
        </button>

    </form>

    <a th:href="@{/}" class="btn btn-secondary mt-3">‚Üê Back to Home</a>
</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
<script>
$('#productImage').change(function () {
    const file = this.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = e => $('#imgPreview').attr('src', e.target.result);
        reader.readAsDataURL(file);
    }
});
</script>

</body>
</html>