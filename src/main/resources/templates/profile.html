<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title> üçΩÔ∏è Spark Cloud Kitchen</title>
     <link rel="icon" type="image/png" href="/images/spark.png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">
</head>
 <style>
.order-status {
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
}

.order-status.cancelled { background:#ff4d4f; color:white; }
.order-status.delivered { background:#52c41a; color:white; }
.order-status.other { background:#faad14; color:#000; }
</style>
<body class="bg-light">

<div th:replace="fragments/navbar :: navbar"></div>

<div class="container mt-5">
    <div class="row justify-content-center">

        <div class="col-md-8">
            <div class="card shadow">

                <div class="card-header bg-primary text-white text-center">
                    <h4>My Profile</h4>
                </div>

                <div class="card-body">

                    <!-- PROFILE IMAGE -->
                    <div class="text-center mb-4">
                        
                        <img th:src="${user.profileImage != null 
    ? '/profile-images/' + user.profileImage 
    : '/images/food1.jpg'}"
     onerror="this.onerror=null; this.src='/images/default-user.png';"
     class="rounded-circle border"
     width="150"
     height="150">
     
     <form th:action="@{/profile/photo}"
      method="post"
      enctype="multipart/form-data"
      class="mt-3">

    <input type="file" name="image" class="form-control mb-2" required>

    <button class="btn btn-outline-primary btn-sm">
        Upload Photo
    </button>
</form>

                    </div>

                    <!-- PROFILE DETAILS -->
                    <form th:action="@{/profile/update}" method="post">

                        <input type="hidden" name="userId" th:value="${user.id}">

                        <div class="mb-3">
                            <label>Name</label>
                            <input type="text" name="name"
                                   class="form-control"
                                   th:value="${user.name}" required>
                        </div>

                        <div class="mb-3">
                            <label>Email</label>
                            <input type="email" name="email"
                                   class="form-control"
                                   th:value="${user.email}" required>
                        </div>

                        <!-- ‚úÖ LOCATION ADDED -->
                        <div class="mb-3">
                            <label>Location</label>
                            <input type="text" name="location"
                                   class="form-control"
                                   th:value="${user.location}">
                        </div>

                        <button class="btn btn-primary w-100">
                            Update Profile
                        </button>
                    </form>

                    <!-- ‚úÖ CHANGE PASSWORD BUTTON -->
                   <a th:href="@{/profile/change-password}"
   class="btn btn-outline-danger mt-3">
    Change Password
</a>
<hr class="my-4">

<h5 class="mb-3">üì¶ My Orders</h5>

<div th:if="${orders.empty}" class="alert alert-info">
    You have not placed any orders yet.
</div>

<table class="table table-bordered table-hover"
       th:if="${!orders.empty}">
    <thead class="table-dark">
    <tr>
        <th>Order ID</th>
        <th>Date</th>
        <th>Amount</th>
        <th>Payment</th>
        <th>Status</th>
        <th>Action</th>
    </tr>
    </thead>

    <tbody>
    <tr th:each="order : ${orders}">

        <td th:text="${order.id}"></td>

        <td th:text="${#temporals.format(order.createdAt,'dd MMM yyyy')}"></td>

        <td>‚Çπ <span th:text="${order.totalAmount}"></span></td>

        <td th:text="${order.paymentMethod}"></td>

        <!-- STATUS -->
        <td class="text-end">
    <span class="order-status cancelled"
          th:if="${order.status.name() == 'CANCELLED'}">Cancelled</span>

    <span class="order-status delivered"
          th:if="${order.status.name() == 'DELIVERED'}">Delivered</span>

    <span class="order-status other"
          th:if="${order.status.name() != 'CANCELLED'
                  and order.status.name() != 'DELIVERED'}"
          th:text="${order.status}"></span>
</td>

        <!-- ACTIONS -->
        <td>

            <!-- TRACK -->
            <a th:href="@{/orders/track/{id}(id=${order.id})}"
               class="btn btn-sm btn-info mb-1">
                Track
            </a>

            <!-- CANCEL -->
            <form th:if="${order.status.name() != 'DELIVERED'
                          and order.status.name() != 'CANCELLED'}"
                  th:action="@{/orders/cancel/{id}(id=${order.id})}"
                  method="post"
                  style="display:inline">

                <button class="btn btn-sm btn-danger"
                        onclick="return confirm('Cancel this order?')">
                    Cancel
                </button>
            </form>

        </td>
    </tr>
    </tbody>
</table>
                </div>
            </div>
        </div>
<a th:href="@{/}" class="btn btn-secondary mt-2 w-10">
    ‚Üê Back
</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>